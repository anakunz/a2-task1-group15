---
title: "Salmon Group 15"
author: "Anastasia Kunz, Zoe Duerksen-Salm, Catherine Takata"
date: "1/30/2021"
output: 
  html_document:
    theme: flatly
    toc: true
    toc_float: true
    code_folding: hide 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(feasts)
library(tsibble)
library(slider)
library(lubridate)
library(patchwork)
```

# Overview:
This “Overview” section (above the tabs) should contain, in whatever order you choose: 
An engaging image (with caption, including photo credit) that is relevant to the dataset
A brief summary (3 - 4 sentences) of the dataset, and what is included in this “report”
A map of the fish ladder location (you can make this in R on your own, or include an existing map appropriately licensed, with attribution)
A professionally formatted data citation
Remember: All code that you used to wrangle the data and prepare the graphs should be available to see if we click on the Code buttons. 

```{r}
#initial data read in

fish_data <- read_csv(here("data","willamette_fish_passage.csv")) %>% 
  clean_names()
```
# Tab 1:
This “Time series” tab should contain: 
A finalized, static graph of adult passage for coho, jack coho, and steelhead salmon (you decide if these all occupy the same panel, or if they are in separate panels). Add a figure caption. Replace NA values with zero. 
2 - 3 bulletpoints summarizing major patterns / notable trends in the salmon passage time series data
Remember: All code that you used to wrangle the data and prepare the graphs should be available to see if we click on the Code buttons. 

```{r timeseries}
# data wrangling: convert date, create tsibble, select species, na to 0
#ts_salmon <- fish_data %>% 
#  select(date, coho, jack_coho, steelhead) %>%
#  pivot_longer(ts_salmon, c(coho, jack_coho, steelhead), names_to = "species") %>% 
#  mutate(date = lubridate::mdy(date)) %>% 
#  as_tsibble(key = NULL, index = date) %>% 
#  mutate_at(c(2:4), ~replace(., is.na(.), 0))

ts_salmon <- fish_data %>% 
  mutate(date = lubridate::mdy(date)) %>% 
  as_tsibble(key = NULL, index = date) %>% 
  select(date, coho, jack_coho, steelhead) %>% 
  mutate_at(c(2:4), ~replace(., is.na(.), 0)) 

#Steelhead Plot

steelhead_plot <-ggplot(ts_salmon, aes(x = date, y = steelhead))+
  geom_line(color = "indianred")+
  labs(
    y = "Steelhead",
    x = " "
  )+
  theme_minimal()+
  ylim(0, 1250)

# Coho Plot
coho_plot <- ggplot(ts_salmon, aes(x = date, y = coho))+
  geom_line(color = "rosybrown")+
  theme_minimal()+
  labs(
    y = "Coho",
    x = "Date"
  )+
  ylim(0, 1250)

# Jack Coho Plot
jackcoho_plot <- ggplot(ts_salmon, aes(x = date, y = jack_coho))+
  geom_line(color = "lightsalmon1")+
  theme_minimal()+
  labs(
    y = "Jack Coho",
    x = " "
  )+
  ylim(0, 1250)


```

```{r}
# Final graph using patchwork

salmon_patchwork <-(steelhead_plot / jackcoho_plot / coho_plot)

salmon_patchwork + plot_annotation(
  title = 'Salmon Run by Species',
  subtitle = 'Number of Steelhead, Coho, and Jack Coho Salmon in the Willamette River 2001 - 2010',
  caption = 'FILL OUT THE CAPTION'
)
```



# Tab 2: Seasonplots

This “Seasonplots” tab should contain: 

- A finalized seasonplot for each species (coho, jack coho, steelhead). You can either facet, or use patchwork, to make the figure. Add a caption. 
- Add 2 - 3 bulletpoints summarizing the major trends you see in the seasonplots.
Remember: All code that you used to wrangle the data and prepare the graphs should be available to see if we click on the Code buttons. 
```{r seasonplot1}
coho_jack_steel <- fish_data %>% 
  select(date, coho, jack_coho, steelhead) 

# convert df to a tsibble
cjs_ts <- coho_jack_steel %>% 
  mutate(date = lubridate::mdy(date)) %>% 
  as_tsibble(key = NULL, index = date)
```

```{r seasonplot2}
cjs_ts_tidy <- cjs_ts %>% 
  pivot_longer(`coho`:`steelhead`, # The columns I'm gathering together
               names_to = "fish_species", # new column name for existing names
               values_to = "fish_count") # new column name to store values

cjs_ts_tidy %>% 
  filter(year(date) > 2000) %>% 
  gg_season(y = fish_count) +
  theme_minimal() +
  labs(x = "Time (month)",
       y = "Total monthly fish count (n)",
       title = "Seasonal Fish Counts")
```


# Tab 3: Summary statistics and analysis 

This “Summary statistics and analysis” tab should contain: 

- A finalized figure of annual totals for fish passage, for each of the 3 species (coho, jack coho, steelhead). You decide if this is in a single panel, or multiple panels. Add a figure caption. 
- Add 2 - 3 bulletpoints summarizing major trends you see in the annual totals by species from 2000 - 2010.


```{r}
#Isolate three fish species: coho, jack, and steelhead with select()
# In a pipe sequence, change the initial "date" and  mutate() to add to the data set
# Mutate() a new column specifically for "year", in order to easily filter data to obtain "annual" fish totals

coho_jackcoho_steelhead <- fish_data %>% 
  mutate(date = mdy(date)) %>% 
  mutate(year = year(date)) %>% 
  select(year, coho, jack_coho, steelhead) %>% 
  pivot_longer(coho:steelhead, 
               names_to = "species",
               values_to = "fish_counts") %>% 
  group_by(year) %>% 
  count(species,  wt = fish_counts)
```


```{r}

ggplot(coho_jackcoho_steelhead, aes(fill = species, x = year, y = n)) +
  geom_col(show.legend = FALSE) + 
  facet_wrap(~species) + 
  scale_x_continuous(breaks = c(2002, 2004, 2006, 2008, 2010)) +
  theme_minimal() +
  labs(title = "Annual Counts of Fish Passage",
       subtitle = "Willamette River, Oregon, US",
       x = "Year",
       y = "Counts of Fish")


#geom_col(position = "dodge", stat = "identity", alpha = 0.7) 
```




